namespace = est_foundation

### FOUNDATION ###

#Foundation, removes modifiers if empire have swapped to confederacy.
event = {
	id = est_foundation.1
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		Or = {
			has_global_flag = est_foundation_adopt_picked_flag	
			has_global_flag = est_confederacy_adopt_picked_flag	
		}
	}

	immediate = { 
		every_country = {
			limit =  {
				has_swapped_tradition = tr_est_confederacy_adopt
				has_country_flag = est_uses_foundation_traditions_flag
			}
			remove_country_flag = est_uses_foundation_traditions_flag
			set_country_flag = est_uses_confederacy_traditions_flag
			if = {
				limit = {
					Not = {
						has_global_flag = est_confederacy_adopt_picked_flag
					}
				}
				set_global_flag = est_confederacy_adopt_flag
			}
			every_owned_planet = {
				if = {
					limit = {
						has_modifier = mod_est_foundation_adopt
					}
					remove_modifier = "mod_est_foundation_adopt"
				}
				if = {
					limit = {
						has_modifier = mod_est_foundation_1
					}
					remove_modifier = "mod_est_foundation_1"
				}
				if = {
					limit = {
						has_modifier = mod_est_foundation_2_1
					}
					remove_modifier = "mod_est_foundation_2_1"
				}
				if = {
					limit = {
						has_modifier = mod_est_foundation_2_2
					}
					remove_modifier = "mod_est_foundation_2_2"
				}
				if = {
					limit = {
						has_modifier = mod_est_foundation_2_3
					}
					remove_modifier = "mod_est_foundation_2_3"
				}
				if = {
					limit = {
						has_modifier = mod_est_foundation_finish
					}
					remove_modifier = "mod_est_foundation_finish"
				}
			}
		}
		every_country = {
			limit =  {
				has_swapped_tradition = tr_est_foundation_adopt
				has_country_flag = est_uses_confederacy_traditions_flag
			}
			remove_country_flag = est_uses_confederacy_traditions_flag
			set_country_flag = est_uses_foundation_traditions_flag
			if = {
				limit = {
					Not = {
						has_global_flag = est_foundation_adopt_picked_flag
					}
				}
				set_global_flag = est_foundation_adopt_flag
			}	
			every_owned_planet = {
				if = {
					limit = {
						has_modifier = mod_est_confederacy_adopt
					}
					remove_modifier = "mod_est_confederacy_adopt"
				}
				if = {
					limit = {
						has_modifier = mod_est_confederacy_2
					}
					remove_modifier = "mod_est_confederacy_2"
				}
			}
		}
	}
}

#Foundation adopt, 1 and finish. Bonus to core planets.
event = {
	id = est_foundation.2
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = est_foundation_adopt_picked_flag	
	}

	immediate = { 
		every_country = {
			limit =  {
				has_non_swapped_tradition = tr_est_foundation_adopt
			}			
			if = {
				limit = {
					Not = {
						has_non_swapped_tradition = tr_est_foundation_1					
					}	
				}
				every_owned_planet = {
					if = {
						limit = {
							sector_controlled = yes 
						}
						if = {
							limit = {
								has_modifier = mod_est_foundation_adopt	
							}
							remove_modifier = "mod_est_foundation_adopt"
						}
					}
					else = {
						if = {
							limit = {
								Not = {
									has_modifier = mod_est_foundation_adopt	
								}
							}
							add_modifier = {
								modifier = "mod_est_foundation_adopt"
							}
						}						
					}
				}	
			}	
			else = {
				if = {
					limit = {
						Not = {
							has_non_swapped_tradition = tr_est_foundation_finish					
						}	
					}	
					every_owned_planet = {
						if = {
							limit = {
								sector_controlled = yes 
							}
							if = {
								limit = {
									has_modifier = mod_est_foundation_1
								}
								remove_modifier = "mod_est_foundation_1"
							}
						}
						else = {
							if = {
								limit = {
									Not = {
										has_modifier = mod_est_foundation_1	
									}
								}
								add_modifier = {
									modifier = "mod_est_foundation_1"
								}
							}						
						}
					}	
				}	
				else = {		
					every_owned_planet = {
						if = {
							limit = {
								sector_controlled = yes 
							}
							if = {
								limit = {
									has_modifier = mod_est_foundation_finish
								}
								remove_modifier = "mod_est_foundation_finish"
							}
						}
						else = {
							if = {
								limit = {
									Not = {
										has_modifier = mod_est_foundation_finish	
									}
								}
								add_modifier = {
									modifier = "mod_est_foundation_finish"
								}
							}						
						}
					}		
				}
			}			
		}		
	}
}

#Foundation 2, bonus to capital.
event = {
	id = est_foundation.3
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = est_foundation_2_picked_flag		
	}
	
	immediate = { 
		every_country = {	
			limit =  {
				has_non_swapped_tradition = tr_est_foundation_2
			}	
			capital_scope = {		
				if = {
					limit = {
						owner = {
							has_technology = tech_galactic_administration
						}
					}	
					if = {
						limit = {
							Not = {
								has_modifier = mod_est_foundation_2_3
							}
						}
						add_modifier = {
							modifier = "mod_est_foundation_2_3"
						}	
						owner = {
							country_event = {
								id = est_foundation.4
							}
						}
					}
				}
				else = {
					if = {
						limit = {
							owner = {
								has_technology = tech_colonial_centralization
							}
						}
						if = {
							limit = {
								Not = {
									has_modifier = mod_est_foundation_2_2
								}
							}
							add_modifier = {
								modifier = "mod_est_foundation_2_2"
							}	
							owner = {
								country_event = {
									id = est_foundation.4
								}
							}
						}
					}
					else = {
						if = {
							limit = {
								Not = {
									has_modifier = mod_est_foundation_2_1
								}
							}
							add_modifier = {
								modifier = "mod_est_foundation_2_1"
							}	
							owner = {
								country_event = {
									id = est_foundation.4
								}
							}
						}
					}
				}
			}
        }
	}
}

#Foundation 2, we have changed capital, remove bonus from old capital.
country_event = {
	id = est_foundation.4
	hide_window = yes
	is_triggered_only = yes
	
	immediate = { 
		every_owned_planet = {
			limit = {
				is_capital = no
				Or = {
					has_modifier = mod_est_foundation_2_1
					has_modifier = mod_est_foundation_2_2
					has_modifier = mod_est_foundation_2_3
				}
			}
			switch = {
				trigger = has_modifier
				
				mod_est_foundation_2_1 = { remove_modifier = "mod_est_foundation_2_1" }	
				mod_est_foundation_2_2 = { remove_modifier = "mod_est_foundation_2_2" }	
				mod_est_foundation_2_3 = { remove_modifier = "mod_est_foundation_2_3" }	
			}
		}
	}
}

#Foundation 2, update bonus to capital with tech.
country_event = {
	id = est_foundation.5
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_non_swapped_tradition = tr_est_foundation_2
	}
	
	immediate = { 
		if = {
			limit = {
				last_increased_tech = tech_galactic_administration
			}
			capital_scope = {
				if = {
					limit = {
						has_modifier = mod_est_foundation_2_2
					}				
					remove_modifier = "mod_est_foundation_2_2"
				}
				else = {
					owner = {
						country_event = {
							id = est_foundation.4
						}
					}
				}
				add_modifier = {
					modifier = "mod_est_foundation_2_3"
				}					
			}
		}
		if = {
			limit = {
				last_increased_tech = tech_colonial_centralization
			}
			capital_scope = {
				if = {
					limit = {
						has_modifier = mod_est_foundation_2_1
					}				
					remove_modifier = "mod_est_foundation_2_1"
				}
				else = {
					owner = {
						country_event = {
							id = est_foundation.4
						}
					}
				}
				add_modifier = {
					modifier = "mod_est_foundation_2_2"
				}					
			}
		}
	}
}


### CONFEDERACY ###

#Confederacy Adopt and 2, gives bonus to sector planets (that have a governor, in the case of 2)
event = {
	id = est_foundation.13
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {	
		has_global_flag = est_confederacy_adopt_picked_flag
	}
	
	immediate = {
		every_country = {
			limit = {
				has_swapped_tradition = tr_est_confederacy_adopt
			}
			every_owned_planet = {	
				if = {
					limit = {
						sector_controlled = yes 
					}
					if = {
						limit = {
							Not = {
								has_modifier = mod_est_confederacy_adopt
							}							
						}
						add_modifier = {
							modifier = "mod_est_confederacy_adopt"							
							days = -1
						}
					}
					if = {
						limit = {
							sector = {
								exists = leader
							}
							owner = {
								has_swapped_tradition = tr_est_confederacy_2
							}
						}
						if = {
							limit = {
								Not = {
									has_modifier = mod_est_confederacy_2
								}							
							}
							add_modifier = {
								modifier = "mod_est_confederacy_2"							
								days = -1
							}
						}	
					}
					else = {
						if = {
							limit = {
								has_modifier = mod_est_confederacy_2								
							}
							remove_modifier = "mod_est_confederacy_2"
						}
					}
				}
				else = {
					if = {
						limit = {
							has_modifier = mod_est_confederacy_adopt								
						}
						remove_modifier = "mod_est_confederacy_adopt"
					}	
					if = {
						limit = {
							has_modifier = mod_est_confederacy_2								
						}
						remove_modifier = "mod_est_confederacy_2"
					}						
				}
			}
		}
	}
}

#Confederacy 4, gives bonuses to subjects.
event = {
	id = est_foundation.14
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {	
		has_global_flag = est_confederacy_4_picked_flag
	}
	immediate = {
		every_country = {
			if = {
				limit = {
					is_subject = yes
					overlord = {
						has_swapped_tradition = tr_est_confederacy_4	
					}
				}
				if = {
					limit = {
						Not = {
							has_modifier = mod_est_confederacy_4
						}
					}
					add_modifier = {
						modifier = "mod_est_confederacy_4"
						days = -1
					}
				}
			}					
			else = {
				if = {
					limit = {
						has_modifier = mod_est_confederacy_4								
					}
					remove_modifier = "mod_est_confederacy_4"
				}					
			}
		}	
	}
}

### SUBMINDS ###

#Subminds Adopt and 2, gives bonus to sector planets (that have a governor, in the case of 2)
event = {
	id = est_foundation.15
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {	
		has_global_flag = est_subminds_adopt_picked_flag
	}
	
	immediate = {
		every_country = {
			limit = {
				Or = {
					has_swapped_tradition = tr_est_subminds_adopt
				}
			}
			every_owned_planet = {	
				if = {
					limit = {
						sector_controlled = yes 
					}
					if = {
						limit = {
							Nor = {
								sector = {
									exists = leader
								}
								owner = {
									has_swapped_tradition = tr_est_subminds_2
								}
							}
						}
						if = {
							limit = {
								has_modifier = mod_est_subminds_2								
							}
							remove_modifier = "mod_est_subminds_2"
						}	
						if = {
							limit = {
								Not = {
									has_modifier = mod_est_subminds_adopt
								}							
							}
							add_modifier = {
								modifier = "mod_est_subminds_adopt"							
								days = -1
							}
						}
					}
					else = {
						if = {
							limit = {
								has_modifier = mod_est_subminds_adopt								
							}
							remove_modifier = "mod_est_subminds_adopt"
						}	
						if = {
							limit = {
								Not = {
									has_modifier = mod_est_subminds_2
								}							
							}
							add_modifier = {
								modifier = "mod_est_subminds_2"							
								days = -1
							}
						}
					}
				}
				else = {
					if = {
						limit = {
							has_modifier = mod_est_subminds_adopt								
						}
						remove_modifier = "mod_est_subminds_adopt"
					}	
					if = {
						limit = {
							has_modifier = mod_est_subminds_2								
						}
						remove_modifier = "mod_est_subminds_2"
					}						
				}
			}
		}
	}
}

#Subminds 3, edict bonus for sector planets
event = {
	id = est_foundation.16
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {	
		Or = {
			has_global_flag = est_subminds_3_picked_flag
			has_global_flag = est_subminds_3_machines_picked_flag
		}
	}
	
	immediate = {
		every_country = {
			limit = {
				Or = {
					has_swapped_tradition = tr_est_subminds_3
					has_swapped_tradition = tr_est_subminds_3_machines
				}
			}
			if = {
				limit = {
					has_policy_flag = policy_flag_est_subminds_3_energy
				}
				every_owned_planet = {
					if = {
						limit = {
							sector_controlled = yes 						
						}
						if = {
							limit = {
								Not = {
									has_modifier = mod_est_subminds_3_energy
								}
							}
							add_modifier = {
								modifier = "mod_est_subminds_3_energy"							
								days = -1
							}
						}
					}
					else = {
						if = {
							limit = {
								has_modifier = mod_est_subminds_3_energy
							}
							remove_modifier = "mod_est_subminds_3_energy"		
						}
					}
				}
			}
			if = {
				limit = {
					has_policy_flag = policy_flag_est_subminds_3_food
				}
				every_owned_planet = {
					if = {
						limit = {
							sector_controlled = yes 						
						}
						if = {
							limit = {
								Not = {
									has_modifier = mod_est_subminds_3_food
								}
							}
							add_modifier = {
								modifier = "mod_est_subminds_3_food"							
								days = -1
							}
						}
					}
					else = {
						if = {
							limit = {
								has_modifier = mod_est_subminds_3_food
							}
							remove_modifier = "mod_est_subminds_3_food"		
						}
					}
				}
			}
			if = {
				limit = {
					has_policy_flag = policy_flag_est_subminds_3_minerals
				}
				every_owned_planet = {
					if = {
						limit = {
							sector_controlled = yes 						
						}
						if = {
							limit = {
								Not = {
									has_modifier = mod_est_subminds_3_minerals
								}
							}
							add_modifier = {
								modifier = "mod_est_subminds_3_minerals"							
								days = -1
							}
						}
					}
					else = {
						if = {
							limit = {
								has_modifier = mod_est_subminds_3_minerals
							}
							remove_modifier = "mod_est_subminds_3_minerals"		
						}
					}
				}
			}
			if = {
				limit = {
					has_policy_flag = policy_flag_est_subminds_3_research
				}
				every_owned_planet = {
					if = {
						limit = {
							sector_controlled = yes 						
						}
						if = {
							limit = {
								Not = {
									has_modifier = mod_est_subminds_3_research
								}
							}
							add_modifier = {
								modifier = "mod_est_subminds_3_research"							
								days = -1
							}
						}
					}
					else = {
						if = {
							limit = {
								has_modifier = mod_est_subminds_3_research
							}
							remove_modifier = "mod_est_subminds_3_research"		
						}
					}
				}
			}
			if = {
				limit = {
					has_policy_flag = policy_flag_est_subminds_3_unity
				}
				every_owned_planet = {
					if = {
						limit = {
							sector_controlled = yes 						
						}
						if = {
							limit = {
								Not = {
									has_modifier = mod_est_subminds_3_unity
								}
							}
							add_modifier = {
								modifier = "mod_est_subminds_3_unity"							
								days = -1
							}
						}
					}
					else = {
						if = {
							limit = {
								has_modifier = mod_est_subminds_3_unity
							}
							remove_modifier = "mod_est_subminds_3_unity"		
						}
					}
				}
			}
		}
	}
}
