namespace = gai_ai_starbase

event = {
	id = gai_ai_starbase.1	
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		every_country = {
			limit = {
				is_ai = yes
				is_country_type = "default"
				#is_at_war = no
				NOT = { has_global_flag = "disable_gai_starbase" }
				OR = {
					minerals > 400
					NOT = {
						any_owned_starbase = {
							has_starbase_module = shipyard
						}
					}
				}
			}
			IF = {
				limit = {
					OR = {
						NOT = { any_owned_starbase = { has_starbase_module = shipyard } }
						AND = {
							has_technology = tech_titans
							NOT = {
								any_owned_starbase = {
									has_starbase_building = titan_yards
								}
							}
						}
						AND = {
							has_ascension_perk = ap_colossus
							NOT = {
								any_owned_starbase = {
									has_starbase_building = colossus_yards
								}
							}
						}
						AND = {
							any_owned_starbase = {
								has_starbase_module = shipyard
								has_starbase_size = starbase_citadel
								count_starbase_modules = {
									type = shipyard
									count < 6
								}
							}
						}
						AND = {
							any_owned_starbase = {
								has_starbase_module = shipyard
								has_starbase_size = starbase_starfortress
								count_starbase_modules = {
									type = shipyard
									count < 6
								}
							}
						}
						AND = {
							any_owned_starbase = {
								has_starbase_module = shipyard
								has_starbase_size = starbase_starhold
								count_starbase_modules = {
									type = shipyard
									count < 4
								}
							}
						}
						AND = {
							any_owned_starbase = {
								has_starbase_module = shipyard
								has_starbase_size = starbase_starport
								count_starbase_modules = {
									type = shipyard
									count < 2
								}
							}
						}
					}
				}
				country_event = { id = gai_ai_starbase.2 }
			}
			IF = {
				limit = {
					OR = {
						used_naval_capacity_percent < 1.00
						AND = {
							any_owned_starbase = {
								has_starbase_module = trading_hub
								has_starbase_size = starbase_citadel
								count_starbase_modules = {
									type = trading_hub
									count < 5
								}
							}
						}
						AND = {
							any_owned_starbase = {
								has_starbase_module = trading_hub
								has_starbase_size = starbase_starfortress
								count_starbase_modules = {
									type = trading_hub
									count < 5
								}
							}
						}
						AND = {
							any_owned_starbase = {
								has_starbase_module = trading_hub
								has_starbase_size = starbase_starhold
								count_starbase_modules = {
									type = trading_hub
									count < 3
								}
							}
						}
						AND = {
							any_owned_starbase = {
								has_starbase_size = starbase_starport
								count_starbase_modules = {
									type = trading_hub
									count < 1
								}
							}
						}
					}
				}
				country_event = { id = gai_ai_starbase.3 } #Build trading hubs
			}
			IF = {
				limit = {
					OR = {
						used_naval_capacity_percent > 1.00
						AND = {
							has_monthly_income = {
								resource = energy
								value > 50
							}
							used_naval_capacity_percent > 0.85
						}
						AND = {
							any_owned_starbase = {
								has_starbase_module = anchorage
								has_starbase_size = starbase_citadel
								count_starbase_modules = {
									type = anchorage
									count < 5
								}
							}
						}
						AND = {
							any_owned_starbase = {
								has_starbase_module = anchorage
								has_starbase_size = starbase_starfortress
								count_starbase_modules = {
									type = anchorage
									count < 5
								}
							}
						}
						AND = {
							any_owned_starbase = {
								has_starbase_module = anchorage
								has_starbase_size = starbase_starhold
								count_starbase_modules = {
									type = anchorage
									count < 3
								}
							}
						}
						AND = {
							any_owned_starbase = {
								has_starbase_size = starbase_starport
								count_starbase_modules = {
									type = anchorage
									count < 1
								}
							}
						}
					}
				}
				country_event = { id = gai_ai_starbase.4 } #build anchorage
			}
			IF = {
				limit = {
					is_at_war = no
					OR = {
						AND = {
							any_owned_starbase = {
								has_starbase_size = starbase_citadel
								NOT = { has_starbase_building = defense_grid }
								OR = {
									has_starbase_module = gun_battery
									has_starbase_module = missile_battery
									has_starbase_module = hangar_bay
								}
							}
						}
						AND = {
							any_owned_starbase = {
								has_starbase_size = starbase_starfortress
								NOT = { has_starbase_building = disruption_field }
								OR = {
									has_starbase_module = gun_battery
									has_starbase_module = missile_battery
									has_starbase_module = hangar_bay
								}
							}
						}
						AND = {
							any_owned_starbase = {
								has_starbase_size = starbase_starhold
								NOT = { has_starbase_building = communications_jammer }
								OR = {
									has_starbase_module = gun_battery
									has_starbase_module = missile_battery
									has_starbase_module = hangar_bay
								}
							}
						}
						AND = {
							any_owned_starbase = {
								has_starbase_size = starbase_starport
								NOT = { has_starbase_building = target_uplink_computer }
								solar_system = { 
									any_planet = {
										and = {
											is_colonizable = no
											is_colony = no
										}
									}
								}
							}
						}
					}
				}
				country_event = { id = gai_ai_starbase.5 } #build bastion
			}
			IF = {
				limit = {
					is_at_war = no
					OR = {
						AND = {
							has_technology = tech_starbase_5
							minerals > 7500
							any_owned_starbase = {
								has_starbase_size = starbase_starfortress
							}
						}
						AND = {
							has_technology = tech_starbase_4
							minerals > 2500
							any_owned_starbase = {
								has_starbase_size = starbase_starhold
							}
						}
						AND = {
							has_technology = tech_starbase_3
							minerals > 750
							any_owned_starbase = {
								has_starbase_size = starbase_starport
							}
						}
					}
				}
				country_event = { id = gai_ai_starbase.6 } #Upgrade Starbase
			}
		}
	}
}

country_event = {
	id = gai_ai_starbase.2
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_owned_starbase =	{
			limit = {
				solar_system = { is_same_value = root.owner.capital_scope.solar_system }
			}
			if = {
				limit = {
					has_starbase_size = starbase_outpost
				}
				set_starbase_size = starbase_starport
			}
			set_starbase_module = {
				slot = 0
				module = shipyard
			}
			set_starbase_module = {
				slot = 1
				module = shipyard
			}
			set_starbase_module = {
				slot = 2
				module = shipyard
			}
			set_starbase_module = {
				slot = 3
				module = shipyard
			}
			set_starbase_module = {
				slot = 4
				module = shipyard
			}
			set_starbase_module = {
				slot = 5
				module = shipyard
			}
			set_starbase_building = {
				slot = 0
				building = crew_quarters
			}
			set_starbase_building = {
				slot = 1
				building = fleet_academy
			}
			IF = {
				limit = {
					owner = { has_ascension_perk = ap_colossus }
					not = { owner = {  any_owned_starbase = { has_starbase_building = colossus_yards } } }
				}
				set_starbase_building = {
					slot = 3
					building = colossus_yards
				}
			}
			IF = {
				limit = {
					owner = { has_technology = tech_titans }
					not = { owner = { any_owned_starbase = { has_starbase_building = titan_yards } } }
				}
				set_starbase_building = {
					slot = 2
					building = titan_yards
				}
			}
		}
	}
}


country_event = {
	id = gai_ai_starbase.3
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_owned_starbase =	{
			limit = {
				NOT = { 
					solar_system = { 
						OR = {
							is_same_value = root.owner.capital_scope.solar_system
							has_star_flag = recently_upgraded_trading
						}
					}
				}
				NOT = { has_starbase_module = anchorage }
				OR = {
					AND = {
						has_starbase_size >= starbase_starport
						count_starbase_modules = {
							type = trading_hub
							count < 1
						}
					}
					AND = {
						has_starbase_size >= starbase_starhold
						count_starbase_modules = {
							type = trading_hub
							count < 3
						}
					}
					AND = {
						has_starbase_size >= starbase_starfortress
						count_starbase_modules = {
							type = trading_hub
							count < 5
						}
					}
				}
				solar_system = {
					OR = {
						any_planet = {
							is_colony = yes
						}
						AND = {
							has_star_flag = enclave
							any_ship_in_system = {
								exists = owner
								owner = {
									has_country_flag = trader_enclave_country
								}
							}
						}			
					}
				}
			}
			
			solar_system = { 
				set_timed_star_flag = {
					flag = recently_upgraded_trading
					days = 2520
				}
			}
			IF = {
				limit = {
					has_starbase_size >= starbase_starport
					owner = { 
						minerals > 400
					}
					NOT = { has_starbase_building = hydroponics_bay }
					NOT = { owner = {has_authority = auth_machine_intelligence} }
				}
				set_starbase_module = {
					slot = 0
					module = shipyard
				}
				set_starbase_module = {
					slot = 1
					module = trading_hub
				}
				owner = {
					add_minerals = -400
				}
				set_starbase_building = {
					slot = 0
					building = hydroponics_bay
				}
			}
			IF = {
				limit = {
					has_starbase_size >= starbase_starhold
					owner = { 
						minerals > 400
					}
					NOT = { has_starbase_building = offworld_trading_company }
					NOT = { owner = {has_authority = auth_machine_intelligence} }
				}
				set_starbase_module = {
					slot = 2
					module = trading_hub
				}
				set_starbase_module = {
					slot = 3
					module = trading_hub
				}
				####ensure correct buildings####
					set_starbase_building = {
						slot = 0
						building = hydroponics_bay
					}
					set_starbase_module = {
						slot = 0
						module = shipyard
					}
					set_starbase_module = {
						slot = 1
						module = trading_hub
					}
				####ensure correct buildings####
				IF = {
					limit = {
						NOT = { has_starbase_building = offworld_trading_company }
					}
					owner = {
						add_minerals = -400
					}
					set_starbase_building = {
						slot = 1
						building = offworld_trading_company
					}
					
				} #This is here so that the AI doesn't pay twice for upgrades when it just needs to goto starhold
			}
			IF = {
				limit = {
					has_starbase_size >= starbase_starfortress
					owner = { 
						minerals > 400
					}
					NOT = { owner = {has_authority = auth_machine_intelligence} }
				}
				set_starbase_module = {
					slot = 4
					module = trading_hub
				}
				set_starbase_module = {
					slot = 5
					module = trading_hub
				}
				####ensure correct buildings####
					set_starbase_building = {
						slot = 0
						building = hydroponics_bay
					}
					set_starbase_module = {
						slot = 0
						module = shipyard
					}
					set_starbase_module = {
						slot = 1
						module = trading_hub
					}
					set_starbase_module = {
						slot = 2
						module = trading_hub
					}
					set_starbase_module = {
						slot = 3
						module = trading_hub
					}
				####ensure correct buildings####
				IF = {
					limit = {
						NOT = { has_starbase_building = resource_silo }
					}
					owner = {
						add_minerals = -400
					}
					set_starbase_building = {
						slot = 2
						building = resource_silo
					}
				}

			}
			IF = {
				limit = {
					has_starbase_size >= starbase_starport
					owner = { 
						minerals > 400
					}
					NOT = { has_starbase_building = offworld_trading_company }
					owner = {has_authority = auth_machine_intelligence}
				}
				set_starbase_module = {
					slot = 0
					module = shipyard
				}
				set_starbase_module = {
					slot = 1
					module = trading_hub
				}
				owner = {
					add_minerals = -400
				}
				set_starbase_building = {
					slot = 0
					building = offworld_trading_company
				}
			}
			IF = {
				limit = {
					has_starbase_size >= starbase_starhold
					owner = { 
						minerals > 400
					}
					NOT = { has_starbase_building = resource_silo }
					owner = {has_authority = auth_machine_intelligence}
				}
				set_starbase_module = {
					slot = 2
					module = trading_hub
				}
				set_starbase_module = {
					slot = 3
					module = trading_hub
				}
				####ensure correct buildings####
					set_starbase_building = {
						slot = 0
						building = offworld_trading_company
					}
					set_starbase_module = {
						slot = 0
						module = shipyard
					}
					set_starbase_module = {
						slot = 1
						module = trading_hub
					}
				####ensure correct buildings####
				IF = {
					limit = {
						NOT = { has_starbase_building = resource_silo }
					}
					owner = {
						add_minerals = -400
					}
					set_starbase_building = {
						slot = 1
						building = resource_silo
					}
				} #This is here so that the AI doesn't pay twice for upgrades when it just needs to goto starhold
			}
			IF = {
				limit = {
					has_starbase_size = starbase_starfortress
					owner = { 
						minerals > 400
					}
					owner = {has_authority = auth_machine_intelligence}
				}
				IF = {
					limit = {
						count_starbase_modules = {
							type = trading_hub
							count < 5
						}
					}
					owner = {
						add_minerals = -400
					}
				} #This is here so that the AI doesn't pay twice for upgrades when it just needs to goto starhold
				set_starbase_module = {
					slot = 4
					module = trading_hub
				}
				set_starbase_module = {
					slot = 5
					module = trading_hub
				}
				####ensure correct buildings####
					set_starbase_building = {
						slot = 0
						building = offworld_trading_company
					}
					set_starbase_building = {
						slot = 1
						building = resource_silo
					}
					set_starbase_module = {
						slot = 0
						module = shipyard
					}
					set_starbase_module = {
						slot = 1
						module = trading_hub
					}
					set_starbase_module = {
						slot = 2
						module = trading_hub
					}
					set_starbase_module = {
						slot = 3
						module = trading_hub
					}
				####ensure correct buildings####
			}
		}
	}
}

country_event = {
	id = gai_ai_starbase.4
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_owned_starbase =	{
			limit = {
				NOT = { 
					solar_system = { 
						OR = {
							is_same_value = root.owner.capital_scope.solar_system
							has_star_flag = recently_upgraded_anchorage
						}
					}
				}
				OR = {
					AND = {
						has_starbase_size >= starbase_starport
						count_starbase_modules = {
							type = anchorage
							count < 1
						}
					}
					AND = {
						has_starbase_size >= starbase_starhold
						count_starbase_modules = {
							type = anchorage
							count < 3
						}
					}
					AND = {
						has_starbase_size >= starbase_starfortress
						count_starbase_modules = {
							type = anchorage
							count < 5
						}
					}
				}
				OR = {
					AND = {
						owner = { 
							OR = {
								used_naval_capacity_percent > 1.00
								AND = {
									has_monthly_income = {
										resource = energy
										value > 50
									}
									used_naval_capacity_percent > 0.85
								}
							}
						}
						has_starbase_module = trading_hub
					}
					has_starbase_module = anchorage
				}
			}
			solar_system = { 
				set_timed_star_flag = {
					flag = recently_upgraded_anchorage
					days = 2520
				}
			}
			IF = {
				limit = {
					has_starbase_size >= starbase_starport
					owner = {has_authority = auth_machine_intelligence}
				}
				set_starbase_module = {
					slot = 0
					module = shipyard
				}
				set_starbase_module = {
					slot = 1
					module = anchorage
				}
				IF = {
					limit = {
						owner = { 
							has_technology = tech_interstellar_fleet_traditions
						}
						NOT = { has_starbase_building = naval_logistics_office }
					}
					set_starbase_building = {
						slot = 0
						building = naval_logistics_office
					}
					owner = {
						add_minerals = -400
					}#Pay
				}
			}
			IF = {
				limit = {
					has_starbase_size >= starbase_starhold
					owner = {has_authority = auth_machine_intelligence}
				}
				set_starbase_module = {
					slot = 2
					module = anchorage
				}
				set_starbase_module = {
					slot = 3
					module = anchorage
				}
				
				IF = {
					limit = {
						NOT = { has_starbase_building = resource_silo }
					}
					set_starbase_building = {
						slot = 1
						building = resource_silo
					}
					owner = {
						add_minerals = -400
					}#Pay
				}
				
				####ensure correct buildings####
					set_starbase_building = {
						slot = 0
						building = naval_logistics_office
					}
					set_starbase_module = {
						slot = 0
						module = shipyard
					}
					set_starbase_module = {
						slot = 1
						module = anchorage
					}
				####ensure correct buildings####

			}
			IF = {
				limit = {
					has_starbase_size >= starbase_starfortress
					owner = {has_authority = auth_machine_intelligence}
				}
				IF = {
					limit = {
						count_starbase_modules = {
							type = anchorage
							count < 5
						}
					}
					owner = {
						add_minerals = -200
					}
				} #This is here so that the AI doesn't pay twice for upgrades when it just needs to goto starhold
				set_starbase_module = {
					slot = 4
					module = anchorage
				}
				set_starbase_module = {
					slot = 5
					module = anchorage
				}

				####ensure correct buildings####
					set_starbase_building = {
						slot = 0
						building = naval_logistics_office
					}
					set_starbase_building = {
						slot = 1
						building = resource_silo
					}
					set_starbase_module = {
						slot = 0
						module = shipyard
					}
					set_starbase_module = {
						slot = 1
						module = anchorage
					}
					set_starbase_module = {
						slot = 2
						module = anchorage
					}
					set_starbase_module = {
						slot = 3
						module = anchorage
					}
					set_starbase_module = {
						slot = 4
						module = anchorage
					}
					set_starbase_module = {
						slot = 5
						module = anchorage
					}
				####ensure correct buildings####
			}
			IF = {
				limit = {
					has_starbase_size >= starbase_starport
					NOT = { owner = {has_authority = auth_machine_intelligence} }
				}
				set_starbase_module = {
					slot = 0
					module = shipyard
				}
				set_starbase_module = {
					slot = 1
					module = anchorage
				}
				IF = {
					limit = {
						NOT = { has_starbase_building = hydroponics_bay }
					}
					set_starbase_building = {
						slot = 0
						building = hydroponics_bay
					}
					owner = {
						add_minerals = -400
					}#Pay
				}
			}
			IF = {
				limit = {
					has_starbase_size >= starbase_starhold
					NOT = { owner = {has_authority = auth_machine_intelligence} }
				}
				set_starbase_module = {
					slot = 2
					module = anchorage
				}
				set_starbase_module = {
					slot = 3
					module = anchorage
				}

				IF = {
					limit = {
						owner = { 
							has_technology = tech_interstellar_fleet_traditions
						}
						NOT = { has_starbase_building = naval_logistics_office }
					}
					set_starbase_building = {
						slot = 1
						building = naval_logistics_office
					}
					owner = {
						add_minerals = -400
					}#Pay
				}
				
				####ensure correct buildings####
					set_starbase_building = {
						slot = 0
						building = hydroponics_bay
					}
					set_starbase_module = {
						slot = 0
						module = shipyard
					}
					set_starbase_module = {
						slot = 1
						module = anchorage
					}
				####ensure correct buildings####
			}
			IF = {
				limit = {
					has_starbase_size >= starbase_starfortress
					NOT = { owner = {has_authority = auth_machine_intelligence} }
				}
				set_starbase_module = {
					slot = 4
					module = anchorage
				}
				set_starbase_module = {
					slot = 5
					module = anchorage
				}
				IF = {
					limit = {
						NOT = { has_starbase_building = resource_silo }
					}
					set_starbase_building = {
						slot = 2
						building = resource_silo
					}
					owner = {
						add_minerals = -400
					}#Pay
				}
				####ensure correct buildings####
					set_starbase_building = {
						slot = 0
						building = hydroponics_bay
					}
					set_starbase_building = {
						slot = 1
						building = naval_logistics_office
					}
					set_starbase_building = {
						slot = 2
						building = resource_silo
					}
					set_starbase_module = {
						slot = 0
						module = shipyard
					}
					set_starbase_module = {
						slot = 1
						module = anchorage
					}
					set_starbase_module = {
						slot = 2
						module = anchorage
					}
					set_starbase_module = {
						slot = 3
						module = anchorage
					}
					set_starbase_module = {
						slot = 4
						module = anchorage
					}
					set_starbase_module = {
						slot = 5
						module = anchorage
					}
				####ensure correct buildings####
			}
		}
	}
}

country_event = {
	id = gai_ai_starbase.5
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_owned_starbase =	{
			limit = {
				solar_system = { 
					NOT = {
						any_planet = {
							OR = {
								is_colonizable = yes
								is_colony = yes
							}
						}
					}
				}
				has_starbase_size >= starbase_starport
			}
			IF = {
				limit = {
					has_starbase_size >= starbase_starport
				}
				IF = {
					limit = {
						count_starbase_modules = {
							type = gun_battery
							count < 1
						}
					}
					owner = {
						add_minerals = -400
					}
				}
				set_starbase_module = {
					slot = 0
					module = gun_battery
				}
				set_starbase_module = {
					slot = 1
					module = missile_battery
				}
				set_starbase_building = {
					slot = 0
					building = target_uplink_computer
				}
			}
			IF = {
				limit = {
					has_starbase_size >= starbase_starhold
				}
				IF = {
					limit = {
						count_starbase_modules = {
							type = gun_battery
							count < 2
						}
					}
					owner = {
						add_minerals = -400
					}
				}
				set_starbase_module = {
					slot = 2
					module = hangar_bay
				}
				set_starbase_module = {
					slot = 3
					module = gun_battery
				}
				set_starbase_building = {
					slot = 1
					building = communications_jammer
				}
			}
			IF = {
				limit = {
					has_starbase_size >= starbase_starfortress
				}
				IF = {
					limit = {
						count_starbase_modules = {
							type = gun_battery
							count < 4
						}
					}
					owner = {
						add_minerals = -400
					}
				}
				set_starbase_module = {
					slot = 4
					module = gun_battery
				}
				set_starbase_module = {
					slot = 5
					module = gun_battery
				}
				set_starbase_building = {
					slot = 2
					building = disruption_field
				}
			}
		}
	}
}

country_event = {
	id = gai_ai_starbase.6
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_owned_starbase =	{
			limit = {
				OR = {
					AND = {
						has_starbase_size = starbase_starport
						owner = { 
							has_technology = tech_starbase_3
							minerals > 750
						}
					}
					AND = {
						has_starbase_size = starbase_starhold
						owner = { 
							has_technology = tech_starbase_4
							minerals > 2500
						}
					}
					AND = {
						has_starbase_size = starbase_starfortress
						owner = { 
							has_technology = tech_starbase_5
							minerals > 7500
						}
					}
				}
			}
			IF = {
				limit = {
					solar_system = { has_star_flag = recently_upgraded_anchorage }
				}
				solar_system = { remove_star_flag = recently_upgraded_anchorage }
			}
			IF = {
				limit = {
					solar_system = { has_star_flag = recently_upgraded_trading }
				}
				solar_system = { remove_star_flag = recently_upgraded_trading }
			}
			IF = {
				limit = {
					owner = { 
						has_technology = tech_starbase_3 
						minerals > 750
					}
					has_starbase_size = starbase_starport
				}
				set_starbase_size = starbase_starhold
				owner = {
					add_minerals = -750
				}
			}
			IF = {
				limit = {
					owner = { 
						has_technology = tech_starbase_4
						minerals > 2500
					}
					has_starbase_size = starbase_starhold
				}
				set_starbase_size = starbase_starfortress
				owner = {
					add_minerals = -2500
				}
			}
			IF = {
				limit = {
					owner = { 
						has_technology = tech_starbase_5 
						minerals > 7500
					}
					has_starbase_size = starbase_starfortress
				}
				set_starbase_size = starbase_citadel
				owner = {
					add_minerals = -7500
				}
			}
		}
	}
}